;/*FB_PKG_DELIM*/

__d("MAWRestoreMessagesFromEncryptedBackupsNOP",["I64","LSDataTraceCheckPoint","LSIntEnum","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUpdateClientRestoreStatus","MAWChatJid","MAWEncryptedBackupsUpdateGlobalRestoreStatus","MAWJobDefinitions","MAWOfflineQueueStatus","MAWTTRC","MAWTimedJob","MAWUpdateClientRestoreStatusOperationType","Promise","ReQL","WAJobOrchestratorTypes","WALoggerDeferred","WATagsLogger","asyncToGeneratorRuntime","cr:4992","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling prefetch for thread ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to get thread key for "," when calling restoreMessagesFromEncryptedBackup"]);l=function(){return a};return a}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){try{c=(yield d("MAWChatJid").toThreadKeyMaybe(a,c));if(c!=null){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("messages_ranges_v2__generated")).getKeyRange(c)));if(a!=null)return a.minMessageId}}catch(a){return(j||(j=b("Promise"))).reject(a)}return});return n.apply(this,arguments)}function o(a,b,c){if(b===0){d("MAWTTRC").startMAWTTRCFlow();d("MAWTTRC").markEvent("eb_restore_start");c&&d("MAWTTRC").markEvent("eb_prefetch_start");return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("mi_act_mapping_table"))).then(function(a){a.forEach(function(a){a=d("MAWJobDefinitions").toThreadJidPrimaryId((h||(h=d("I64"))).to_string(a.jid));d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"restore");c&&d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"ebprefetch")})})}}function a(a,b,c,d,e,f,g,h,i,j,k,l){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,h,n,p,q,r,s,t,u){var v=(yield d("MAWChatJid").toThreadKeyMaybe(a,f));v==null&&void d("WALoggerDeferred").ERROR(l(),f);v=!d("MAWOfflineQueueStatus").isOfflineQueueComplete()&&b("cr:4992")!=null&&t==null&&f!=null;var w=d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").getCurrentGlobalRestoreStatusArrayLength("restore");yield o(a,w,v);try{w=(yield m(a,f));if(v&&b("cr:4992")!=null){d("WATagsLogger").TAGS(["labyrinth_web"]).LOG(k(),f);v={action:d("MAWUpdateClientRestoreStatusOperationType").upsertClientRestoreStatus,threadId:f};yield d("MAWBridgeUpdateClientRestoreStatus").call(a,v);yield b("cr:4992")(a,e,f,g,h,n,p,q,r,s,t,w,u)}else{c("promiseDone")(d("MAWTimedJob").TimedUIJobStarters.fireAndForget(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(e,f,g,h,p,r,(v=w)!=null?v:void 0,(n=s)!=null?n:void 0,(q=t)!=null?q:void 0,void 0,void 0,u,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})))}}catch(e){if(s!=null)return d("MAWBridgeTraceRecordCheckpointHandler").call(a,{checkPointId:(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),dataTraceId:s,errorMessage:e,shouldFlush:!0,syncChannel:-1,tags:void 0}).then(function(){return(j||(j=b("Promise"))).reject(e)})}return(j||(j=b("Promise"))).resolve([[],[],!0])});return p.apply(this,arguments)}g.call=a}),98);
__d("LSPlatformDevtools.bs",["LSPlatformDevtools"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("LSPlatformDevtools").registerDb(a)}g.registerDb=a}),98);