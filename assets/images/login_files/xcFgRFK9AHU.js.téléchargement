;/*FB_PKG_DELIM*/

__d("LSGetParentThreadKey",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[];return b.seq([function(e){return b.seq([function(d){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[0]=b.i64.cast([0,0]):(d=a.item,c[0]=d.parentThreadKey)})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}b=a;f["default"]=b}),66);
__d("LSUpdateFolderThreadSnippet",["LSGetThreadParticipantDisplayName","LSGetViewerFBID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return c.i64.eq(a[0],c.i64.cast([-1,4294967284]))&&!1?c.seq([function(b){return c.i64.neq(a[1],f)?c.resolve(d[1]=a[1]):c.seq([function(b){return c.ct(c.ftr(c.db.table(9).fetch([[[a[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.lt(b.lastReadWatermarkTimestampMs,b.lastActivityTimestampMs)})).then(function(a){return d[3]=a})},function(a){return d[1]=d[3]}])},function(e){return c.i64.eq(d[1],c.i64.cast([0,0]))?c.seq([function(a){return c.sp(b("LSGetViewerFBID")).then(function(a){return a=a,d[3]=a[0],a})},function(b){return c.ct(c.ftr(c.db.table(9).fetch([[[a[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.eq(b.lastReadWatermarkTimestampMs,b.lastActivityTimestampMs)&&c.i64.neq(b.snippetSenderContactId,d[3])})).then(function(a){return d[4]=a})},function(e){return c.i64.eq(c.i64.cast([0,0]),d[4])?c.resolve((d[6]=a[2].get("all_read"),a[2],d[5]=d[6])):c.seq([function(a){return c.sp(b("LSGetViewerFBID")).then(function(a){return a=a,d[6]=a[0],a})},function(b){return c.islc(c.ftr(c.db.table(9).fetchDesc([[[a[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.eq(b.lastReadWatermarkTimestampMs,b.lastActivityTimestampMs)&&c.i64.neq(b.snippetSenderContactId,d[6])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(e=["",c.i64.cast([-1,4294967295])],d[7]=e[0],d[8]=e[1],e):(b=a.item,e=[b.snippet,b.threadKey],d[7]=e[0],d[8]=e[1],e)})},function(a){return c.sp(b("LSGetViewerFBID")).then(function(a){return a=a,d[10]=a[0],a})},function(a){return c.islc(c.db.table(14).fetch([[[d[8],{gt:d[10]}],[d[8],{lt:d[10]}]]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?d[11]=c.i64.cast([-1,4294967295]):(b=a.item,d[11]=b.contactId)})},function(a){return c.sp(b("LSGetThreadParticipantDisplayName"),d[8],d[11]).then(function(a){return a=a,d[13]=a[0],a})},function(a){return c.i64.eq(d[4],c.i64.cast([0,1]))?c.seq([function(a){return d[15]=c.createArray(),d[17]=(d[15].push(d[13]),d[15]),c.localizeV2Async(c.i64.cast([0,1907280305]),d[15]).then(function(a){return d[16]=a})},function(a){return d[14]=d[16]}]):c.seq([function(a){return d[15]=c.createArray(),d[17]=(d[15].push(d[13]),d[15]),c.localizeV2Async(c.i64.cast([0,1112375422]),d[15]).then(function(a){return d[16]=a})},function(a){return d[14]=d[16]}])},function(a){return d[5]=d[14]}])},function(a){return d[2]=d[5]}]):c.seq([function(e){return c.i64.eq(d[1],c.i64.cast([0,1]))?c.seq([function(b){return c.islc(c.ftr(c.db.table(9).fetchDesc([[[a[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.lt(b.lastReadWatermarkTimestampMs,b.lastActivityTimestampMs)}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(e=["",c.i64.cast([-1,4294967295])],d[4]=e[0],d[5]=e[1],e):(b=a.item,e=[b.snippet,b.threadKey],d[4]=e[0],d[5]=e[1],e)})},function(b){return d[4]!==f?d[7]=d[4]:(d[8]=a[2].get("unread_singular"),a[2],d[7]=[c.i64.to_string(d[1]),d[8]].join("")),d[3]=d[7]}]):c.seq([function(b){return c.islc(c.ftr(c.db.table(9).fetchDesc([[[a[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.lt(b.lastReadWatermarkTimestampMs,b.lastActivityTimestampMs)}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(e=["",c.i64.cast([-1,4294967295])],d[4]=e[0],d[5]=e[1],e):(b=a.item,e=[b.snippet,b.threadKey],d[4]=e[0],d[5]=e[1],e)})},function(a){return c.sp(b("LSGetViewerFBID")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return c.islc(c.db.table(14).fetch([[[d[5],{gt:d[7]}],[d[5],{lt:d[7]}]]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?d[8]=c.i64.cast([-1,4294967295]):(b=a.item,d[8]=b.contactId)})},function(a){return c.sp(b("LSGetThreadParticipantDisplayName"),d[5],d[8]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[11]=c.createArray(),d[13]=(d[11].push(c.i64.to_string(d[1])),d[11]),d[13]=(d[11].push(d[10]),d[11]),c.localizeV2Async(c.i64.cast([0,2889251507]),d[11]).then(function(a){return d[12]=a})},function(a){return d[3]=d[12]}])},function(a){return d[2]=d[3]}])},function(a){return d[0]=d[2]}]):c.seq([function(b){return c.i64.neq(a[1],f)?c.resolve(d[1]=a[1]):c.seq([function(b){return c.ct(c.ftr(c.db.table(9).fetch([[[a[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.lt(b.lastReadWatermarkTimestampMs,b.lastActivityTimestampMs)})).then(function(a){return d[6]=a})},function(a){return d[1]=d[6]}])},function(b){return d[2]=a[2].get("all_read"),a[2],d[3]=a[2].get("unread_singular"),a[2],d[4]=a[2].get("unread_plural"),a[2],c.i64.eq(d[1],c.i64.cast([0,0]))?d[5]=d[2]:(c.i64.eq(d[1],c.i64.cast([0,1]))?d[6]=[c.i64.to_string(d[1]),d[3]].join(""):d[6]=[c.i64.to_string(d[1]),d[4]].join(""),d[5]=d[6]),d[0]=d[5]}])},function(b){return c.fe(c.db.table(9).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({snippet:d[0],snippetStringHash:f,snippetStringArgument1:f,snippetAttribution:f,snippetAttributionStringHash:f})})}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSUpdateParentFolderReadWatermark",["LSGetParentThreadKey","LSUpdateFolderThreadSnippet"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return c.sp(b("LSGetParentThreadKey"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(e){return c.i64.neq(d[0],c.i64.cast([0,0]))?c.seq([function(a){return c.sb(c.ftr(c.db.table(9).fetch([[[d[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(a){return c.i64.eq(a.parentThreadKey,d[0])&&c.i64.lt(a.lastReadWatermarkTimestampMs,a.lastActivityTimestampMs)}),[["lastReadWatermarkTimestampMs","ASC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[1]=f:(b=a.item,d[1]=b.lastReadWatermarkTimestampMs)})},function(a){return c.i64.neq(d[1],f)?c.fe(c.db.table(9).fetch([[[d[0]]]]),function(a){var b=a.update;a.item;return b({lastReadWatermarkTimestampMs:d[1]})}):c.seq([function(a){return c.db.table(9).fetch([[[d[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[3]=f:(b=a.item,d[3]=b.lastActivityTimestampMs)})},function(a){return c.i64.neq(d[3],f)?c.fe(c.db.table(9).fetch([[[d[0]]]]),function(a){var b=a.update;a.item;return b({lastReadWatermarkTimestampMs:d[3]})}):c.resolve()}])},function(e){return c.sp(b("LSUpdateFolderThreadSnippet"),d[0],f,a[1])}]):c.resolve()}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSUpsertFolder",["LSUpdateFolderThreadSnippet"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(b){return c.i64.neq(a[3],f)?c.resolve(d[0]=a[3]):c.seq([function(b){return c.db.table(9).fetchDesc([[[a[0]]],"parentThreadKeyLastActivityTimestampMs"]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[3]=c.i64.cast([0,0]):(b=a.item,d[3]=b.lastActivityTimestampMs)})},function(a){return d[0]=d[3]}])},function(b){return c.i64.neq(a[4],f)?c.resolve(d[1]=a[4]):c.seq([function(b){return c.sb(c.ftr(c.db.table(9).fetch([[[a[0]]],"parentThreadKeyLastActivityTimestampMs"]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.lt(b.lastReadWatermarkTimestampMs,b.lastActivityTimestampMs)}),[["lastReadWatermarkTimestampMs","ASC"]]).next().then(function(b,e){var g=b.done;b=b.value;return g?c.seq([function(b){return c.i64.neq(a[3],f)?c.resolve(d[5]=a[3]):c.seq([function(b){return c.db.table(9).fetchDesc([[[a[0]]],"parentThreadKeyLastActivityTimestampMs"]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[6]=c.i64.cast([0,0]):(e=b.item,d[6]=e.lastActivityTimestampMs)})},function(a){return d[5]=d[6]}])},function(a){return d[3]=d[5]}]):(e=b.item,d[3]=e.lastReadWatermarkTimestampMs)})},function(a){return d[1]=d[3]}])},function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(b,e){e=b.done;b=b.value;return e?c.seq([function(b){return c.fe(c.ftr(c.db.table(9).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.lt(b.authorityLevel,c.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(b){return c.db.table(9).add({threadKey:a[0],mailboxType:c.i64.cast([0,0]),threadType:c.i64.cast([0,6]),threadName:a[1],folderName:"",parentThreadKey:c.i64.cast([0,0]),threadPictureUrl:a[2],lastActivityTimestampMs:d[0],lastReadWatermarkTimestampMs:d[1],removeWatermarkTimestampMs:c.i64.cast([0,0]),muteExpireTimeMs:c.i64.cast([0,0]),snippet:"",isAdminSnippet:!1,hasPersistentMenu:!1,disableComposerInput:!1,snippetHasEmoji:!1,authorityLevel:c.i64.cast([0,80]),ongoingCallState:c.i64.cast([0,0]),capabilities:c.i64.cast([0,0]),shouldRoundThreadPicture:!1})}]):(b.item,c.fe(c.db.table(9).fetch([[[a[0]]]]),function(b){var e=b.update;b.item;return e({threadName:a[1],folderName:"",parentThreadKey:c.i64.cast([0,0]),threadPictureUrl:a[2],lastActivityTimestampMs:d[0],lastReadWatermarkTimestampMs:d[1],removeWatermarkTimestampMs:c.i64.cast([0,0]),muteExpireTimeMs:c.i64.cast([0,0]),snippet:"",snippetText:f,snippetStringHash:f,snippetStringArgument1:f,snippetAttribution:f,snippetAttributionStringHash:f,isAdminSnippet:!1,hasPersistentMenu:!1,disableComposerInput:!1,snippetHasEmoji:!1,authorityLevel:c.i64.cast([0,80]),ongoingCallState:c.i64.cast([0,0]),capabilities:c.i64.cast([0,0]),shouldRoundThreadPicture:!1})}))})},function(d){return c.sp(b("LSUpdateFolderThreadSnippet"),a[0],a[5],a[6])}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);